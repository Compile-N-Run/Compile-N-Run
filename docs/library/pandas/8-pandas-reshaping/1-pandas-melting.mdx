---
title: Pandas Melting
description: Learn how to reshape wide-format DataFrames into long-format using the pandas melt function, a crucial technique for data transformation and preparation for analysis.

---

# Pandas Melting

## Introduction

Data often comes in various formats, and being able to reshape it to suit your analysis is a crucial skill in data manipulation. Pandas provides a powerful function called `melt()` that helps transform data from wide format to long format. This transformation is especially useful when preparing data for visualization libraries like Seaborn or for specific statistical analyses that require data in long format.

In this tutorial, we'll explore pandas melting operations in depth, understand when and why to use them, and see practical examples that demonstrate their utility in real-world scenarios.

## What is Melting?

Melting is the process of transforming a DataFrame from wide format to long format by converting columns into rows. It's essentially the opposite of pivoting.

### Key Concepts:

- **Wide Format**: Data where multiple variables are spread across columns
- **Long Format**: Data where variables are organized in rows rather than columns
- **id_vars**: Columns to keep as identifier variables
- **value_vars**: Columns to "melt" or unpivot into rows
- **var_name**: Name for the variable column (contains former column names)
- **value_name**: Name for the value column (contains former column values)

## Basic Melting Example

Let's start with a simple example to understand how melting works:

```python
import pandas as pd
import numpy as np

# Create a sample DataFrame in wide format
df = pd.DataFrame({
    'Name': ['John', 'Jane', 'Mike', 'Sarah'],
    'Math': [90, 85, 92, 88],
    'Science': [88, 91, 85, 94],
    'History': [76, 82, 89, 90]
})

print("Original DataFrame (Wide Format):")
print(df)
```

This will output:

```
Original DataFrame (Wide Format):
    Name  Math  Science  History
0   John    90       88       76
1   Jane    85       91       82
2   Mike    92       85       89
3  Sarah    88       94       90
```

Now, let's melt this DataFrame to convert it from wide to long format:

```python
# Melt the DataFrame to transform it to long format
melted_df = pd.melt(df, 
                    id_vars=['Name'],  # Column(s) to keep as is
                    value_vars=['Math', 'Science', 'History'],  # Columns to melt
                    var_name='Subject',  # Name for the new column of melted column names
                    value_name='Score')  # Name for the new column of values

print("\nMelted DataFrame (Long Format):")
print(melted_df)
```

This will output:

```
Melted DataFrame (Long Format):
     Name  Subject  Score
0    John     Math     90
1    Jane     Math     85
2    Mike     Math     92
3   Sarah     Math     88
4    John  Science     88
5    Jane  Science     91
6    Mike  Science     85
7   Sarah  Science     94
8    John  History     76
9    Jane  History     82
10   Mike  History     89
11  Sarah  History     90
```

## Understanding the Parameters

The `melt()` function has several parameters that control how the reshaping occurs:

### 1. `id_vars`

These are the columns to keep as is. They act as identifiers in the melted DataFrame.

```python
# Only keeping 'Name' as an identifier
melted_df = pd.melt(df, id_vars=['Name'])
print(melted_df.head())
```

### 2. `value_vars`

These are the columns you want to unpivot or "melt". If not specified, all columns not in `id_vars` will be melted.

```python
# Only melting 'Math' and 'Science' columns
melted_df = pd.melt(df, 
                   id_vars=['Name'], 
                   value_vars=['Math', 'Science'])
print(melted_df.head())
```

### 3. `var_name` and `value_name`

These parameters allow you to specify custom names for the columns that will contain the melted column names and their values.

```python
melted_df = pd.melt(df, 
                   id_vars=['Name'], 
                   value_vars=['Math', 'Science', 'History'],
                   var_name='Course',  # Custom name for column of variable names
                   value_name='Grade')  # Custom name for column of values
print(melted_df.head())
```

## Practical Applications

### Example 1: Preparing Data for Time Series Visualization

Melting is often used when preparing data for time series visualization with libraries like Seaborn.

```python
# Create data with multiple metrics over time
dates = pd.date_range(start='2023-01-01', periods=5, freq='D')
data = {
    'Date': dates,
    'Temperature': [32, 35, 29, 30, 31],
    'Humidity': [80, 76, 83, 85, 79],
    'Rainfall': [0, 5, 12, 3, 0]
}

weather_df = pd.DataFrame(data)
print("Original Weather Data:")
print(weather_df)

# Melt the DataFrame for visualization
melted_weather = pd.melt(weather_df, 
                         id_vars=['Date'],
                         var_name='Measurement',
                         value_name='Value')
print("\nMelted Weather Data:")
print(melted_weather.head(10))

# Now this data is ready for a time series visualization with Seaborn
```

### Example 2: Dealing with Survey Data

Survey data often comes in wide format, with each question as a column. Melting helps analyze responses across questions.

```python
# Survey data (wide format)
survey_data = pd.DataFrame({
    'Respondent': ['Person1', 'Person2', 'Person3', 'Person4'],
    'Q1_Satisfaction': [5, 4, 3, 5],
    'Q2_Recommend': [4, 5, 3, 4],
    'Q3_Usability': [4, 3, 5, 4]
})

print("Original Survey Data:")
print(survey_data)

# Melt to get all responses in one column
melted_survey = pd.melt(survey_data, 
                        id_vars=['Respondent'],
                        var_name='Question',
                        value_name='Rating')

print("\nMelted Survey Data:")
print(melted_survey)

# Clean up the Question column by removing the Q1_, Q2_, etc. prefixes
melted_survey['Question'] = melted_survey['Question'].str.split('_').str[1]
print("\nCleaned Survey Data:")
print(melted_survey)
```

### Example 3: Reshaping for Statistical Analysis

Many statistical functions require data in long format.

```python
# Create a dataset of student test scores across multiple attempts
test_scores = pd.DataFrame({
    'Student': ['Alex', 'Beth', 'Charlie', 'Diana'],
    'Attempt1': [85, 92, 78, 88],
    'Attempt2': [89, 94, 82, 91],
    'Attempt3': [92, 96, 85, 93]
})

print("Original Test Scores:")
print(test_scores)

# Melt to analyze improvement over attempts
melted_scores = pd.melt(test_scores, 
                        id_vars=['Student'],
                        var_name='Attempt',
                        value_name='Score')

print("\nMelted Test Scores:")
print(melted_scores)

# Extract attempt number for analysis
melted_scores['AttemptNumber'] = melted_scores['Attempt'].str.extract('(\d+)').astype(int)
print("\nWith Attempt Number:")
print(melted_scores)

# Now we can easily calculate improvement statistics
improvement = melted_scores.pivot_table(
    index='Student',
    columns='AttemptNumber',
    values='Score'
).diff(axis=1)

print("\nImprovement Between Attempts:")
print(improvement)
```

## Common Gotchas and Tips

### 1. Handling Multiple ID Variables

You can specify multiple columns as `id_vars`:

```python
# Dataset with multiple identifiers
complex_df = pd.DataFrame({
    'Region': ['North', 'North', 'South', 'South'],
    'Year': [2022, 2023, 2022, 2023],
    'Sales': [100, 120, 90, 110],
    'Expenses': [80, 85, 70, 75],
    'Profit': [20, 35, 20, 35]
})

# Melt with multiple id variables
melted_complex = pd.melt(complex_df,
                         id_vars=['Region', 'Year'],
                         var_name='Metric',
                         value_name='Amount')

print(melted_complex)
```

### 2. Using Method Syntax

Pandas also offers a method syntax for melting:

```python
# Method syntax
melted_df = df.melt(id_vars=['Name'], 
                    value_vars=['Math', 'Science', 'History'],
                    var_name='Subject',
                    value_name='Score')
```

### 3. Handling Missing Values

Melting preserves missing values:

```python
# DataFrame with missing values
df_missing = pd.DataFrame({
    'Name': ['John', 'Jane', 'Mike'],
    'Math': [90, np.nan, 85],
    'Science': [88, 91, np.nan]
})

melted_missing = pd.melt(df_missing,
                         id_vars=['Name'],
                         var_name='Subject',
                         value_name='Score')

print("Original with missing values:")
print(df_missing)
print("\nMelted with missing values:")
print(melted_missing)
```

## Comparing `melt()` with `stack()`

Pandas offers another function called `stack()` that performs a similar operation. Here's a quick comparison:

```python
# Original data
data = pd.DataFrame({
    'Name': ['John', 'Jane'],
    'Math': [90, 85],
    'Science': [88, 91]
})

# Using melt
melted = pd.melt(data, 
                id_vars=['Name'], 
                value_vars=['Math', 'Science'],
                var_name='Subject',
                value_name='Score')

# Using stack (requires setting an index first)
stacked = data.set_index('Name').stack().reset_index()
stacked.columns = ['Name', 'Subject', 'Score']

print("Using melt():")
print(melted)
print("\nUsing stack():")
print(stacked)
```

The main differences:
- `melt()` is more straightforward for simple use cases
- `stack()` works with MultiIndex DataFrames and preserves the index structure
- `melt()` offers more control over naming the resulting columns

## Summary

Pandas melting is a powerful reshaping operation that transforms data from wide format to long format. This transformation is especially useful when:

1. Preparing data for visualization libraries that require long-format data
2. Conducting statistical analyses that need variables in a single column
3. Creating tidy datasets where each variable forms a column, each observation forms a row
4. Normalizing inconsistent data structures for uniform processing

The `melt()` function provides several parameters to customize the reshaping process, allowing you to specify which columns to keep as identifiers, which columns to melt, and how to name the resulting columns.

## Exercises

1. Create a DataFrame representing monthly sales figures for different products across different years. Use `melt()` to reshape it for time-series analysis.

2. Take a dataset with demographic information (age, income, education) across different cities and use `melt()` to prepare it for boxplot visualization.

3. Challenge: Given a dataset of student performance in multiple subjects across multiple years, use `melt()` to identify which subjects show the most improvement over time.

## Additional Resources

- [Pandas Official Documentation on melt()](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.melt.html)
- [Tidy Data Paper by Hadley Wickham](https://www.jstatsoft.org/article/view/v059i10) - Explains the principles behind reshaping data
- [Pandas Reshaping Guide](https://pandas.pydata.org/pandas-docs/stable/user_guide/reshaping.html) - Comprehensive guide to all reshaping operations in Pandas

By mastering the `melt()` function, you've added a crucial data transformation tool to your pandas skills that will help you prepare data for various types of analyses and visualizations.