---
title: Label Matchers in LogQL
description: Learn how to filter and select log streams in Grafana Loki using label matchers

---

# Label Matchers

## Introduction

Label matchers are a fundamental concept in LogQL, the query language used by Grafana Loki. They allow you to filter and select log streams based on their labels. In Loki, logs are organized into streams identified by a set of labels, similar to how Prometheus organizes its time series data. Label matchers provide a powerful way to precisely target the log data you need, making your queries more efficient and your analysis more focused.

## What are Labels in Loki?

Before diving into label matchers, let's understand what labels are:

- **Labels** are key-value pairs attached to log streams in Loki
- They provide metadata about the log source (e.g., `app="frontend"`, `environment="production"`)
- Labels are indexed, making filtering by labels very efficient
- Common labels include: `job`, `namespace`, `pod`, `container`, `level`, `app`, etc.

## Basic Label Matcher Syntax

LogQL label matchers follow a similar syntax to Prometheus's PromQL. A basic label matcher looks like this:

```
{label="value"}
```

This will select all log streams where the label exactly matches the specified value.

### Example

To query logs from the `nginx` application in the `production` environment:

```logql
{app="nginx", environment="production"}
```

This query returns all logs from streams that have both labels matching exactly.

## Types of Label Matchers

LogQL supports several types of label matching operations:

| Operator | Description     | Example                  |
|----------|-----------------|--------------------------|
| `=`      | Exact match     | `{app="nginx"}`          |
| `!=`     | Not equal       | `{app!="nginx"}`         |
| `=~`     | Regex match     | `{app=~"nginx\|apache"}` |
| `!~`     | Regex not match | `{app!~"nginx\|apache"}` |

Let's explore each of these in detail.

### Exact Match (`=`)

The exact match operator selects logs where the label exactly equals the specified value.

```logql
{environment="production"}
```

This returns all logs from streams with the label `environment` set to exactly `production`.

### Not Equal (`!=`)

The not-equal operator selects logs where the label does not equal the specified value.

```logql
{environment!="development"}
```

This returns all logs from streams where the `environment` label is not `development` (including logs from streams that don't have the `environment` label at all).

### Regex Match (`=~`)

The regex match operator selects logs where the label matches the specified regular expression.

```logql
{app=~"nginx.*"}
```

This returns all logs from streams where the `app` label starts with `nginx`.

### Regex Not Match (`!~`)

The regex not-match operator selects logs where the label does not match the specified regular expression.

```logql
{app!~".*test.*"}
```

This returns all logs from streams where the `app` label does not contain the word `test`.

## Combining Multiple Label Matchers

You can combine multiple label matchers to create more specific queries:

```logql
{app="frontend", environment="production", level=~"error|warn"}
```

This query selects logs from:
- The `frontend` application
- In the `production` environment
- With log level either `error` or `warn`

### Comma vs. No Comma

In LogQL, when you specify multiple label matchers:

- Using commas between matchers creates an **AND** operation
- Using no commas (space in the UI) would be invalid syntax

```logql
{app="api", environment="production"}  // Logs from 'api' AND in 'production'
```

## Label Matcher Performance Considerations

When using label matchers in Loki, keep these performance tips in mind:

1. **Use Labels Wisely**: Filter by labels first before performing log content filtering
2. **Be Specific**: The more specific your label matchers, the faster your queries
3. **Avoid Regex When Possible**: Exact matches (`=`) are faster than regex matches (`=~`)
4. **Label Cardinality**: Too many unique label values (high cardinality) can impact performance

## Real-World Examples

### Example 1: Troubleshooting Application Errors

Finding all error logs from a specific service in production:

```logql
{app="payment-service", environment="production", level="error"}
```

### Example 2: Investigating Container Issues

Looking for logs from a specific container in a Kubernetes pod that's having issues:

```logql
{namespace="ecommerce", pod=~"checkout-.*", container="api"}
```

### Example 3: Monitoring Multiple Services

Monitoring error logs across multiple related microservices:

```logql
{app=~"order-.*|payment-.*", environment="production", level=~"error|fatal"}
```

### Example 4: Excluding Noisy Components

Getting all logs from a system except for a particularly noisy component:

```logql
{app="backend", component!="health-check"}
```

## Label Matchers with Log Line Filtering

Label matchers are often combined with log line filtering to further refine results:

```logql
{app="api", environment="production"} |= "error"
```

This query:
1. First selects all logs from the `api` app in `production` using label matchers
2. Then filters those logs to only include lines containing the word "error"

## Visualizing Label Matcher Concept

Here's a diagram showing how label matchers work:

```mermaid
graph TD
    A[All Log Streams] --> B{Label Matchers}
    B -->|app="frontend"| C[Frontend Logs]
    B -->|environment="production"| D[Production Logs]
    B -->|level="error"| E[Error Logs]
    C --> F{Combined Filter}
    D --> F
    E --> F
    F --> G[Final Result: Frontend + Production + Error Logs]
```

## Summary

Label matchers are a powerful feature in LogQL that allow you to efficiently filter and select log streams based on their metadata. They form the foundation of any LogQL query and understanding them well is crucial for effective log querying in Grafana Loki.

Key takeaways:
- Labels provide metadata about log streams
- Label matchers filter logs based on these labels
- Different matcher types provide flexibility in filtering
- Combining label matchers allows for precise targeting of logs
- Always start with label matchers before filtering log content

## Practice Exercises

1. Write a label matcher to select logs from the `auth-service` in both `staging` and `production` environments.
2. Create a query that finds error logs from any service except `background-jobs`.
3. Write a query to find logs from containers whose names start with `api-` in the `default` namespace.

## Additional Resources

- [Grafana Loki Documentation](https://grafana.com/docs/loki/latest/)
- [LogQL Query Language Reference](https://grafana.com/docs/loki/latest/logql/)
- [Loki Best Practices](https://grafana.com/docs/loki/latest/best-practices/)