---
title: RabbitMQ AMQP 1.0 Plugin
description: Learn how to enable and use the AMQP 1.0 protocol with RabbitMQ through the dedicated plugin, allowing interoperability with other AMQP 1.0 compliant systems

---

# RabbitMQ AMQP 1.0 Plugin

## Introduction

The RabbitMQ AMQP 1.0 plugin extends RabbitMQ's capabilities by adding support for the AMQP 1.0 protocol, which is different from the AMQP 0-9-1 protocol that RabbitMQ natively uses. This plugin enables RabbitMQ to communicate with other systems that implement AMQP 1.0, such as Apache ActiveMQ, Microsoft Azure Service Bus, or Apache Qpid.

AMQP 1.0 is an ISO and OASIS standard messaging protocol designed for interoperability between different message-oriented middleware systems. By adding AMQP 1.0 support to RabbitMQ, you can create heterogeneous messaging environments where RabbitMQ can act as a bridge between different messaging systems.

## Prerequisites

Before you begin working with the AMQP 1.0 plugin, make sure you have:

- RabbitMQ server installed (version 3.8.0 or newer recommended)
- Administrative access to your RabbitMQ server
- Basic familiarity with RabbitMQ concepts and administration

## Enabling the AMQP 1.0 Plugin

The AMQP 1.0 plugin comes bundled with RabbitMQ but is not enabled by default. You can enable it using the RabbitMQ management plugin or the command line.

### Using the Command Line

To enable the plugin using the rabbitmq-plugins command:

```bash
rabbitmq-plugins enable rabbitmq_amqp1_0
```

You should see output similar to:

```
Enabling plugins on node rabbit@hostname:
rabbitmq_amqp1_0
The following plugins have been configured:
  rabbitmq_amqp1_0
Applying plugin configuration to rabbit@hostname...
Plugin configuration unchanged.
```

### Using the Management UI

1. Log in to the RabbitMQ Management UI (typically at http://localhost:15672)
2. Navigate to the "Admin" tab
3. Select "Plugins" from the menu
4. Find "rabbitmq_amqp1_0" in the list
5. Enable the plugin by clicking the "Enable" button

After enabling the plugin, you may need to restart the RabbitMQ server for the changes to take effect.

## Understanding AMQP 1.0 vs AMQP 0-9-1

Before we dive deeper, it's important to understand the key differences between AMQP 1.0 and the AMQP 0-9-1 protocol that RabbitMQ uses natively:

| Feature | AMQP 0-9-1 | AMQP 1.0 |
|---------|------------|----------|
| Exchanges | Required for routing | Not part of the core specification |
| Queues | Core concept | Not part of the core specification |
| Bindings | Core concept | Not part of the core specification |
| Architecture | Broker-centric | Peer-to-peer capable |
| Standardization | De facto standard | ISO and OASIS standard |
| Message Addressing | Via exchanges and routing keys | Via source/target addresses |

The AMQP 1.0 plugin maps these different concepts to allow interoperability between the two protocol versions.

## AMQP 1.0 Port Configuration

By default, the AMQP 1.0 plugin listens on port 5672, the same port as AMQP 0-9-1. The plugin detects which protocol a client is using and handles the connection accordingly.

You can configure a dedicated port for AMQP 1.0 in your RabbitMQ configuration file:

```erlang
[
  {rabbitmq_amqp1_0, [
    {default_user, <<"guest">>},
    {default_vhost, <<"/">>},
    {protocol_strict_mode, false}
  ]},
  {rabbit, [
    {tcp_listeners, [{"127.0.0.1", 5672}]},
    {amqp1_0_tcp_listeners, [{"127.0.0.1", 5673}]}
  ]}
].
```

This configuration sets up a dedicated AMQP 1.0 listener on port 5673.

## Basic Messaging with AMQP 1.0

Let's look at how to send and receive messages using AMQP 1.0 with RabbitMQ. We'll use the `rhea` library for Node.js as our client.

### Installation

First, install the rhea library:

```bash
npm install rhea
```

### Sending Messages

```javascript
const rhea = require('rhea');

// Configure the connection
const connection = rhea.connect({
  container_id: 'amqp1_0_sender',
  host: 'localhost',
  port: 5672,
  username: 'guest',
  password: 'guest'
});

// Create a sender
const sender = connection.open_sender('my-queue');

// Wait for sender to be ready
sender.on('sender_open', function() {
  console.log('Sender open');
  
  // Send a message
  sender.send({
    body: 'Hello AMQP 1.0 World!'
  });
  
  console.log('Message sent');
  
  // Close the connection after sending
  setTimeout(function() {
    connection.close();
  }, 1000);
});

// Handle errors
connection.on('error', function(err) {
  console.error('Connection error:', err);
});
```

### Receiving Messages

```javascript
const rhea = require('rhea');

// Configure the connection
const connection = rhea.connect({
  container_id: 'amqp1_0_receiver',
  host: 'localhost',
  port: 5672,
  username: 'guest',
  password: 'guest'
});

// Create a receiver
const receiver = connection.open_receiver('my-queue');

// Process received messages
connection.on('message', function(context) {
  console.log('Received message:', context.message.body);
  
  // Acknowledge the message
  if (context.delivery) {
    context.delivery.accept();
  }
});

// Handle receiver open event
receiver.on('receiver_open', function() {
  console.log('Receiver open and ready to receive messages');
});

// Handle errors
connection.on('error', function(err) {
  console.error('Connection error:', err);
});

// Keep the connection open to receive messages
console.log('Waiting for messages...');
```

## Addressing in AMQP 1.0

In AMQP 1.0, addressing works differently from AMQP 0-9-1. The RabbitMQ AMQP 1.0 plugin maps AMQP 1.0 addresses to RabbitMQ exchanges and queues based on specific rules:

1. If an address starts with `queue://`, it will be treated as a RabbitMQ queue
2. If an address starts with `exchange://`, it will be treated as a RabbitMQ exchange
3. If an address starts with `topic://`, it will be treated as a RabbitMQ topic exchange
4. If none of the above prefixes are used, the address will be treated as a queue by default

### Example with Different Address Types

```javascript
// Connect to a queue
const queueReceiver = connection.open_receiver('queue://my-queue');

// Connect to a direct exchange
const exchangeSender = connection.open_sender('exchange://my-exchange/routing-key');

// Connect to a topic exchange
const topicSender = connection.open_sender('topic://topic-exchange/routing.key.pattern');
```

## Advanced Features

### Message Properties and Annotations

AMQP 1.0 provides rich message properties and annotations. Here's how to use them with the `rhea` client:

```javascript
sender.send({
  message_id: 'msg-123',
  user_id: 'app1',
  to: 'queue://destination',
  subject: 'Important Message',
  reply_to: 'queue://replies',
  correlation_id: 'correlation-123',
  content_type: 'application/json',
  content_encoding: 'utf-8',
  creation_time: new Date(),
  absolute_expiry_time: new Date(Date.now() + 3600000), // 1 hour from now
  group_id: 'group-A',
  group_sequence: 1,
  reply_to_group_id: 'replies-group-A',
  application_properties: {
    'custom-property': 'custom-value'
  },
  body: { data: 'Hello AMQP 1.0 World!' }
});
```

### Transactions

AMQP 1.0 supports transactional messaging. Here's how to use transactions with the `rhea` client:

```javascript
const rhea = require('rhea');
const connection = rhea.connect({
  container_id: 'transaction_example',
  host: 'localhost',
  port: 5672,
  username: 'guest',
  password: 'guest'
});

// Create a sender
const sender = connection.open_sender('my-queue');

// Create a transaction controller
const txnController = connection.open_sender({
  target: { address: 'coordinator' },
  properties: { coordType: 'amqp:coordinator:transactions' }
});

// Start a transaction when the controller is ready
txnController.on('sender_open', function() {
  const txnId = Buffer.from('txn-' + Date.now());
  
  // Declare transaction
  txnController.send({
    body: { txn_id: txnId },
    message_id: 'declare-' + txnId,
    message_annotations: { txn_id: txnId }
  });
  
  // Send messages in the transaction when sender is ready
  sender.on('sender_open', function() {
    // Send a message within the transaction
    sender.send({
      body: 'Transactional message',
      message_annotations: { txn_id: txnId }
    });
    
    // Commit the transaction
    txnController.send({
      body: { txn_id: txnId },
      message_id: 'commit-' + txnId,
      message_annotations: { txn_id: txnId }
    });
    
    console.log('Transaction committed');
    setTimeout(() => connection.close(), 1000);
  });
});
```

## Real-World Use Case: Bridging Different Messaging Systems

One of the most common use cases for the AMQP 1.0 plugin is creating a bridge between different messaging systems. Let's see how to create a bridge between RabbitMQ and Azure Service Bus.

### Scenario

We want to publish messages to RabbitMQ and have them automatically forwarded to Azure Service Bus, which uses AMQP 1.0.

### Implementation

First, we'll create a Node.js application that acts as the bridge:

```javascript
const amqplib = require('amqplib'); // AMQP 0-9-1 client for RabbitMQ
const rhea = require('rhea');       // AMQP 1.0 client for Azure Service Bus

async function setupBridge() {
  // Connect to RabbitMQ using AMQP 0-9-1
  const rabbitmqConn = await amqplib.connect('amqp://guest:guest@localhost:5672');
  const rabbitmqChannel = await rabbitmqConn.createChannel();
  
  // Create a queue to consume from
  const sourceQueue = 'source_queue';
  await rabbitmqChannel.assertQueue(sourceQueue, { durable: true });
  
  // Connect to Azure Service Bus using AMQP 1.0
  const serviceBusConn = rhea.connect({
    container_id: 'rabbitmq_azure_bridge',
    host: 'your-servicebus-namespace.servicebus.windows.net',
    port: 5671,
    username: 'your-shared-access-key-name',
    password: 'your-shared-access-key',
    transport: 'tls'
  });
  
  // Create a sender to Azure Service Bus
  const sender = serviceBusConn.open_sender('destination-queue');
  
  // Wait for the sender to be ready
  await new Promise(resolve => {
    sender.on('sender_open', resolve);
  });
  
  console.log('Bridge established');
  
  // Consume messages from RabbitMQ and forward to Azure Service Bus
  rabbitmqChannel.consume(sourceQueue, (msg) => {
    if (msg) {
      const content = msg.content.toString();
      console.log(`Forwarding message: ${content}`);
      
      // Send to Azure Service Bus
      sender.send({
        body: content,
        application_properties: {
          original_exchange: msg.fields.exchange,
          original_routing_key: msg.fields.routingKey
        }
      });
      
      // Acknowledge the message
      rabbitmqChannel.ack(msg);
    }
  });
  
  console.log('Bridge is running. Press Ctrl+C to exit.');
}

setupBridge().catch(error => {
  console.error('Bridge error:', error);
  process.exit(1);
});
```

This bridge application consumes messages from a RabbitMQ queue and forwards them to an Azure Service Bus queue using AMQP 1.0.

## Troubleshooting Common Issues

### Connection Refused

If you encounter a "Connection refused" error, check:
- The AMQP 1.0 plugin is enabled
- The port you're connecting to is correct
- Firewall settings are not blocking the connection

### Authentication Failed

If authentication fails:
- Verify the username and password
- Check user permissions in RabbitMQ
- Ensure the virtual host exists and the user has access to it

### Mapping Errors

If you see errors related to address mapping:
- Check that your addresses follow the correct format (queue://, exchange://, topic://)
- Verify that the exchange or queue exists in RabbitMQ
- Check that any required bindings are in place

## Advanced Configuration Options

The AMQP 1.0 plugin offers several configuration options that can be set in your RabbitMQ configuration file:

```erlang
[
  {rabbitmq_amqp1_0, [
    % Default user for AMQP 1.0 connections
    {default_user, <<"guest">>},
    
    % Default virtual host
    {default_vhost, <<"/">>},
    
    % Enable/disable strict mode for protocol handling
    {protocol_strict_mode, false},
    
    % Set the maximum frame size (in bytes)
    {frame_max, 131072},
    
    % Set the heartbeat interval (in seconds)
    {heartbeat, 60},
    
    % Configure SASL mechanisms
    {sasl_mechanisms, {pam, ["PLAIN", "AMQPLAIN"]}}
  ]}
].
```

## Visualizing AMQP 1.0 Message Flow

Let's visualize how a message flows when using the AMQP 1.0 plugin with RabbitMQ:

```mermaid
sequenceDiagram
    participant Client as AMQP 1.0 Client
    participant Plugin as AMQP 1.0 Plugin
    participant Core as RabbitMQ Core
    participant Queue as RabbitMQ Queue
    
    Client->>Plugin: Connect (AMQP 1.0)
    Plugin->>Core: Authenticate & Create Session
    Core-->>Plugin: Session Established
    Plugin-->>Client: Connection Established
    
    Client->>Plugin: Create Sender Link to "my-queue"
    Plugin->>Core: Resolve Address "my-queue"
    Core-->>Plugin: Address Resolved as Queue
    Plugin-->>Client: Sender Link Established
    
    Client->>Plugin: Send Message
    Plugin->>Core: Translate to AMQP 0-9-1 Format
    Core->>Queue: Store Message
    Queue-->>Core: Message Stored
    Core-->>Plugin: Delivery Status
    Plugin-->>Client: Message Accepted
    
    Note over Client,Queue: Later, when a consumer connects...
    
    Client->>Plugin: Create Receiver Link from "my-queue"
    Plugin->>Core: Resolve Address "my-queue"
    Core-->>Plugin: Address Resolved as Queue
    Plugin-->>Client: Receiver Link Established
    
    Plugin->>Core: Subscribe to Queue
    Core->>Queue: Get Messages
    Queue-->>Core: Return Message
    Core-->>Plugin: Deliver Message
    Plugin->>Client: Transfer Message (AMQP 1.0 Format)
    Client-->>Plugin: Accept Message
    Plugin-->>Core: Acknowledge Message
```

## Summary

The RabbitMQ AMQP 1.0 plugin extends RabbitMQ's capabilities by adding support for the AMQP 1.0 protocol, which enables interoperability with various messaging systems that use this standard protocol. Key points covered in this guide:

- Enabling and configuring the AMQP 1.0 plugin
- Understanding the differences between AMQP 0-9-1 and AMQP 1.0
- Sending and receiving messages using AMQP 1.0 clients
- Working with different address types in AMQP 1.0
- Using advanced features like message properties and transactions
- Implementing a real-world bridge between RabbitMQ and Azure Service Bus
- Troubleshooting common issues
- Configuring advanced options for the plugin

With the AMQP 1.0 plugin, RabbitMQ can act as a central hub in a heterogeneous messaging environment, allowing for communication between different systems and platforms, regardless of their native messaging protocol.

## Additional Resources

To deepen your understanding of the RabbitMQ AMQP 1.0 plugin, check out these resources:

1. [Official RabbitMQ AMQP 1.0 Plugin Documentation](https://www.rabbitmq.com/plugins.html)
2. [AMQP 1.0 Specification](http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-overview-v1.0-os.html)
3. [Rhea - AMQP 1.0 Client for Node.js](https://github.com/amqp/rhea)

## Exercises

### Exercise 1: Basic Setup

Enable the AMQP 1.0 plugin and verify it's working by checking the RabbitMQ management UI or using the `rabbitmq-plugins list` command.

### Exercise 2: Simple Messaging

Create a Node.js application that sends and receives messages using the AMQP 1.0 protocol with RabbitMQ. Use the code examples provided in this guide as a starting point.

### Exercise 3: Address Mapping

Experiment with different address formats (`queue://`, `exchange://`, `topic://`) and observe how RabbitMQ maps them to its native concepts.

### Exercise 4: Advanced Messaging Patterns

Implement a request-response pattern using AMQP 1.0 with RabbitMQ. Use the `reply_to` field to specify where responses should be sent.

### Exercise 5: Integration Challenge

Create a simple bridge application that connects RabbitMQ to another AMQP 1.0 compliant system (such as ActiveMQ or Apache Qpid) and demonstrate message flow between the two systems.