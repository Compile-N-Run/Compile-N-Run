---
title: MongoDB Troubleshooting
description: Learn how to identify, diagnose, and fix common MongoDB issues. This guide covers connection problems, performance issues, query optimization, and data consistency concerns with practical solutions.

---

# MongoDB Troubleshooting

## Introduction

Even with the best database design and implementation, issues can arise when working with MongoDB. Being able to identify, diagnose, and resolve these problems efficiently is a crucial skill for any developer working with MongoDB. This guide covers common MongoDB issues you might encounter and provides practical approaches to troubleshooting them.

Troubleshooting MongoDB involves understanding various aspects of the database system, from connection issues to performance problems and data consistency concerns. By following systematic approaches to identify and resolve these issues, you can maintain a healthy, reliable MongoDB deployment.

## Common Connection Issues

### Cannot Connect to MongoDB Server

One of the most common issues beginners face is being unable to connect to their MongoDB server.

#### Symptoms:
- Error messages like "connection refused" or "couldn't connect to server"
- Application hangs when trying to connect to the database

#### Troubleshooting Steps:

1. **Verify MongoDB is running**

```bash
# On Linux/macOS
ps aux | grep mongod

# On Windows (PowerShell)
Get-Process mongod
```

2. **Check MongoDB configuration**

Ensure MongoDB is listening on the expected port and interface:

```bash
# View MongoDB configuration
cat /etc/mongod.conf

# Check if MongoDB is listening on the expected port (default is 27017)
netstat -tuln | grep 27017
```

3. **Test connectivity with the MongoDB shell**

```bash
# Connect to local MongoDB
mongosh

# Connect to remote MongoDB
mongosh mongodb://username:password@hostname:port/database
```

4. **Firewall and network issues**

If connecting to a remote server, check if the port is open:

```bash
telnet hostname 27017
# or
nc -zv hostname 27017
```

### Authentication Problems

#### Symptoms:
- "Authentication failed" errors
- "not authorized" messages

#### Troubleshooting Steps:

1. **Verify credentials**

```javascript
// Connect with explicit authentication
mongosh --username myUser --password myPassword --authenticationDatabase admin
```

2. **Check user permissions**

```javascript
// Inside MongoDB shell, check your user's roles
db.runCommand({ connectionStatus: 1 })
```

3. **Create a new user if needed**

```javascript
// Create a user with appropriate permissions
db.createUser({
  user: "myNewUser",
  pwd: "securePassword",
  roles: [{ role: "readWrite", db: "myDatabase" }]
})
```

## Performance Issues

### Slow Queries

#### Symptoms:
- Queries taking longer than expected
- Increasing response times as data grows

#### Troubleshooting Steps:

1. **Use Explain to analyze query performance**

```javascript
// Basic explain
db.collection.find({ status: "active" }).explain()

// Detailed execution stats
db.collection.find({ status: "active" }).explain("executionStats")
```

2. **Check for missing indexes**

The IXSCAN stage in explain output indicates an index is being used. COLLSCAN means a full collection scan is happening, which is slower:

```javascript
// Create an index to improve query performance
db.collection.createIndex({ status: 1 })

// Compound index for multiple fields
db.collection.createIndex({ status: 1, createdAt: -1 })
```

3. **Monitor slow queries**

Enable the MongoDB profiler to log slow operations:

```javascript
// Enable profiling for operations slower than 100ms
db.setProfilingLevel(1, 100)

// Check slow queries
db.system.profile.find().sort({ ts: -1 }).limit(10)
```

### High CPU Usage

#### Troubleshooting Steps:

1. **Check server status**

```javascript
db.serverStatus()
```

2. **Analyze current operations**

```javascript
// Find currently running operations
db.currentOp()

// Find long-running operations (taking more than 5 seconds)
db.currentOp({ "secs_running": { $gt: 5 } })
```

3. **Kill problematic operations if necessary**

```javascript
// Kill an operation by its opid
db.killOp(opId)
```

## Data Consistency and Integrity Issues

### Duplicate Keys

#### Symptoms:
- Error messages containing "duplicate key" when inserting documents
- Failed bulk operations

#### Troubleshooting Steps:

1. **Identify the duplicate documents**

```javascript
// Find documents with the same key value
db.collection.aggregate([
  { $group: { _id: "$fieldName", count: { $sum: 1 } } },
  { $match: { count: { $gt: 1 } } }
])
```

2. **Handle the duplicates**

```javascript
// Option 1: Update the duplicate documents to make them unique
db.collection.updateOne(
  { _id: duplicateDocId },
  { $set: { uniqueField: "newUniqueValue" } }
)

// Option 2: Remove duplicates keeping one
const duplicates = db.collection.aggregate([
  { $group: { _id: "$fieldName", docs: { $push: "$_id" }, count: { $sum: 1 } } },
  { $match: { count: { $gt: 1 } } }
]).toArray();

duplicates.forEach(group => {
  // Keep the first document, remove the rest
  group.docs.slice(1).forEach(docId => {
    db.collection.deleteOne({ _id: docId });
  });
});
```

### Corrupt Indexes

#### Symptoms:
- Unexpected query results
- Error messages related to index entries

#### Troubleshooting Steps:

1. **Check index consistency**

```javascript
db.collection.validate({ full: true })
```

2. **Rebuild indexes if necessary**

```javascript
// Rebuild all indexes on a collection
db.collection.reIndex()

// Drop and recreate a specific index
db.collection.dropIndex("indexName_1")
db.collection.createIndex({ indexName: 1 })
```

## Common MongoDB Error Codes

Understanding common MongoDB error codes can help quickly identify issues:

| Error Code | Description | Common Solution |
|------------|-------------|----------------|
| 13 | Unauthorized | Check user permissions and authentication |
| 48 | Invalid Namespace | Verify database and collection names |
| 112 | Write Concern Error | Check network or replica set status |
| 11000 | Duplicate Key | Handle duplicate values as shown above |
| 16755 | Too many open cursors | Close unused cursors or increase limit |

## Diagnosing MongoDB Performance Flow

Here's a workflow diagram to help you diagnose MongoDB performance issues:

```mermaid
flowchart TD
    A[Slow MongoDB Performance] --> B{Query Problem?}
    B -->|Yes| C[Check Indexes]
    B -->|No| D{Connection Problem?}
    C --> C1[Run Explain]
    C1 --> C2{Using Indexes?}
    C2 -->|No| C3[Create Appropriate Indexes]
    C2 -->|Yes| C4[Check Query Structure]
    D -->|Yes| E[Check Connection Pool]
    D -->|No| F{High CPU/Memory?}
    E --> E1[Adjust Connection Settings]
    F -->|Yes| G[Check Server Resources]
    F -->|No| H[Check Disk I/O]
    G --> G1["Monitor with db.serverStatus()"]
    H --> H1[Check for Disk Saturation]
```

## Real-world Troubleshooting Scenarios

### Scenario 1: E-commerce Application with Slow Product Searches

**Problem**: An e-commerce application's product search functionality becomes increasingly slow as the product catalog grows.

**Diagnosis**:
```javascript
// Check current search query
db.products.find({ 
  category: "electronics",
  price: { $lt: 1000 },
  status: "in-stock"
}).explain("executionStats")
```

The explain output shows a COLLSCAN operation with high executionTimeMillis, indicating a full collection scan.

**Solution**:
```javascript
// Create a compound index for common search patterns
db.products.createIndex({ 
  category: 1, 
  status: 1, 
  price: 1 
})

// Verify index is used
db.products.find({ 
  category: "electronics",
  price: { $lt: 1000 },
  status: "in-stock"
}).explain()
// Should now show IXSCAN instead of COLLSCAN
```

**Result**: Search queries execution time improved from 500ms to 15ms.

### Scenario 2: User Authentication Failures in a Web Application

**Problem**: Users intermittently report being unable to log in to a web application that uses MongoDB for authentication.

**Diagnosis**:
```javascript
// Check MongoDB logs for authentication issues
db.adminCommand({ getLog: "global" })

// Check current connections
db.currentOp(true)
```

The logs reveal occasional connection timeouts due to exceeding the default connection pool size.

**Solution**:
1. Update MongoDB connection string in the application:

```javascript
// Before
const uri = "mongodb://localhost:27017/myapp";

// After - increase connection pool size
const uri = "mongodb://localhost:27017/myapp?maxPoolSize=100";
```

2. Monitor connection usage:

```javascript
// Check connection statistics
db.serverStatus().connections
```

**Result**: Authentication failures decreased by 95% after implementing the solution.

## Best Practices for Avoiding Common Issues

1. **Regular Monitoring**
   - Set up monitoring tools like MongoDB Atlas monitoring, Prometheus with MongoDB exporter, or MMS
   - Create alerts for key metrics like connections, queues, and operation time

2. **Proper Indexing Strategy**
   - Index fields that appear in query conditions, sort operations, and join conditions
   - Use compound indexes for frequently run queries with multiple conditions
   - Avoid over-indexing, as it slows down write operations

3. **Connection Management**
   - Use connection pooling
   - Close unused connections
   - Configure appropriate timeouts

4. **Regular Backups**
   - Schedule regular backups
   - Test restoration procedures periodically

5. **Update MongoDB Regularly**
   - Stay current with MongoDB releases for security patches and performance improvements

## Troubleshooting Tools and Commands

### MongoDB Compass

MongoDB Compass is a graphical interface that can help with:
- Visualizing schema
- Analyzing query performance
- Creating and managing indexes
- Monitoring server statistics

### Essential MongoDB Diagnostic Commands

```javascript
// Server status overview
db.serverStatus()

// Database statistics
db.stats()

// Collection statistics
db.collection.stats()

// Index usage statistics
db.collection.aggregate([
  { $indexStats: {} }
])

// Check storage engine status
db.serverStatus().storageEngine

// View replica set status
rs.status()

// Check shard status
sh.status()
```

## Summary

Troubleshooting MongoDB effectively requires a systematic approach to identifying and resolving issues. This guide covered:

- Common connection issues and how to resolve them
- Performance troubleshooting techniques including query optimization and index management
- Data consistency and integrity problem resolution
- Real-world scenarios with practical solutions
- Best practices to avoid common MongoDB problems

By following the strategies outlined in this guide, you'll be better equipped to diagnose and fix MongoDB issues, ensuring your applications remain performant and reliable.

## Additional Resources

- [MongoDB Official Documentation: Troubleshooting](https://docs.mongodb.com/manual/faq/)
- [MongoDB University: Diagnostic Thinking Course](https://university.mongodb.com/)
- [MongoDB Performance Best Practices](https://docs.mongodb.com/manual/administration/performance/)

## Exercises to Practice Troubleshooting

1. **Connection Exercise**: Set up a MongoDB instance with authentication and practice connecting with incorrect and correct credentials. Document the error messages.

2. **Performance Exercise**: Create a collection with 100,000+ documents, run queries without indexes, analyze performance, then create appropriate indexes and compare the difference.

3. **Corruption Exercise**: In a test database, manually modify data files (never in production!) to simulate corruption, then practice repair techniques.

4. **Monitoring Exercise**: Set up MongoDB with a monitoring tool and create load to observe how various operations affect system metrics.

5. **Index Analysis Exercise**: Create a collection with various indexes, then use explain() to analyze how different query patterns utilize these indexes.