---
title: Terraform AWS Authentication
description: Learn how to securely authenticate Terraform with AWS to manage infrastructure resources

---

# Terraform AWS Authentication

## Introduction

When working with Terraform to manage AWS infrastructure, proper authentication is crucial. Authentication ensures that Terraform has the necessary permissions to create, modify, and delete AWS resources on your behalf. This guide explores the various methods to authenticate Terraform with AWS, helping you choose the most appropriate approach for your environment.

Authentication is the foundation of security when working with cloud providers. Without proper authentication practices, you risk exposing credentials or granting excessive permissions that could lead to security breaches or unintended resource modifications.

## AWS Authentication Basics

Before diving into Terraform-specific methods, let's understand what AWS authentication involves:

1. **Identity** - Who is making the request (a user, application, or service)
2. **Credentials** - Proof of identity (access keys, tokens, etc.)
3. **Permissions** - What the identity is allowed to do (via IAM policies)

Terraform needs valid AWS credentials to interact with AWS services. These credentials determine what actions Terraform can perform on your AWS resources.

## Authentication Methods for Terraform

Terraform supports multiple authentication methods for AWS, each with its own use cases and security considerations.

### 1. Static Credentials

Static credentials involve directly specifying your AWS access key ID and secret access key in your Terraform configuration.

```hcl
provider "aws" {
  region     = "us-west-2"
  access_key = "AKIAIOSFODNN7EXAMPLE"
  secret_key = "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"
}
```

**Output:** Terraform will use these credentials for all AWS API calls.

:::caution
This method is not recommended for production environments as it stores sensitive credentials in plaintext. If your Terraform files are committed to version control, your credentials could be exposed.
:::

**When to use:** Testing or learning environments only.

### 2. Environment Variables

A more secure approach is to use environment variables to provide AWS credentials:

```bash
export AWS_ACCESS_KEY_ID="AKIAIOSFODNN7EXAMPLE"
export AWS_SECRET_ACCESS_KEY="wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"
export AWS_REGION="us-west-2"
```

Then, your Terraform configuration can be simplified:

```hcl
provider "aws" {
  region = "us-west-2"
}
```

**Output:** Terraform will automatically detect and use the credentials from environment variables.

**When to use:** Development environments or CI/CD pipelines where environment variables can be securely managed.

### 3. Shared Credentials File

AWS CLI stores credentials in a file located at `~/.aws/credentials` on Linux/macOS or `%USERPROFILE%\.aws\credentials` on Windows.

Example credentials file:

```ini
[default]
aws_access_key_id = AKIAIOSFODNN7EXAMPLE
aws_secret_access_key = wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY

[project1]
aws_access_key_id = AKIAI44QH8DHBEXAMPLE
aws_secret_access_key = je7MtGbClwBF/2Zp9Utk/h3yCo8nvbEXAMPLEKEY
```

In your Terraform configuration, you can specify which profile to use:

```hcl
provider "aws" {
  region  = "us-west-2"
  profile = "project1"
}
```

**Output:** Terraform will use the credentials associated with the specified profile.

**When to use:** When managing multiple AWS accounts or roles from your local development environment.

### 4. AWS IAM Roles for EC2 Instances

If Terraform is running on an EC2 instance, you can assign an IAM role to the instance and Terraform will automatically use those credentials.

```hcl
provider "aws" {
  region = "us-west-2"
}
```

**How to set up:**

1. Create an IAM role with the necessary permissions
2. Attach the role to your EC2 instance
3. Run Terraform on that instance - no explicit credentials needed

**Output:** Terraform automatically uses the temporary credentials provided by the instance metadata service.

**When to use:** When running Terraform from EC2 instances in a secure environment.

### 5. AWS IAM Roles with AssumeRole

For more complex scenarios, Terraform can assume an IAM role to gain temporary credentials:

```hcl
provider "aws" {
  region = "us-west-2"
  assume_role {
    role_arn     = "arn:aws:iam::123456789012:role/TerraformExecutionRole"
    session_name = "terraform-session"
    external_id  = "some-external-id"  # Optional
  }
}
```

**Output:** Terraform uses temporary credentials obtained by assuming the specified role.

**When to use:** Multi-account setups, when you need to separate permissions between different environments or when implementing a "least privilege" security model.

### 6. AWS Single Sign-On (AWS SSO)

For organizations using AWS SSO, you can configure profiles in your AWS config file:

```ini
[profile my-sso-profile]
sso_start_url = https://my-sso-portal.awsapps.com/start
sso_region = us-west-2
sso_account_id = 123456789012
sso_role_name = SSOReadOnlyRole
region = us-west-2
```

Then reference this profile in your Terraform configuration:

```hcl
provider "aws" {
  profile = "my-sso-profile"
  region  = "us-west-2"
}
```

**Output:** Terraform will prompt you to authenticate via your browser if SSO credentials aren't cached.

**When to use:** Enterprise environments using AWS SSO for identity management.

## Authentication Order of Precedence

Terraform follows a specific order when looking for AWS credentials:

1. Explicit provider block credentials
2. The `AWS_ACCESS_KEY_ID` and `AWS_SECRET_ACCESS_KEY` environment variables
3. The credentials file at `~/.aws/credentials`
4. The AWS CLI configuration file at `~/.aws/config`
5. EC2 instance metadata service for credentials from IAM roles

Understanding this order helps troubleshoot authentication issues when multiple credential sources are present.

## Practical Example: Setting up a Secure Pipeline

Let's walk through a practical example of setting up Terraform with secure authentication for a CI/CD pipeline.

### Step 1: Create an IAM User for Terraform

First, create a dedicated IAM user for Terraform operations:

1. Go to the AWS IAM console
2. Create a new user named `terraform-automation`
3. Do not generate access keys yet

### Step 2: Create an IAM Role

Create a role with the permissions Terraform needs:

```hcl
resource "aws_iam_role" "terraform_execution_role" {
  name = "TerraformExecutionRole"
  
  assume_role_policy = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Action = "sts:AssumeRole"
        Effect = "Allow"
        Principal = {
          AWS = "arn:aws:iam::${var.account_id}:user/terraform-automation"
        }
        Condition = {
          StringEquals = {
            "sts:ExternalId": var.external_id
          }
        }
      }
    ]
  })
}

resource "aws_iam_role_policy_attachment" "terraform_policy" {
  role       = aws_iam_role.terraform_execution_role.name
  policy_arn = "arn:aws:iam::aws:policy/PowerUserAccess"  # Adjust as needed
}
```

### Step 3: Configure CI/CD Environment Variables

In your CI/CD system (e.g., GitHub Actions, Jenkins, GitLab CI), set up secure environment variables:

```yaml
# Example GitHub Actions workflow snippet
jobs:
  terraform:
    runs-on: ubuntu-latest
    steps:
      # ...other steps...
      - name: Configure AWS Credentials
        uses: aws-actions/configure-aws-credentials@v1
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: us-west-2
          role-to-assume: arn:aws:iam::123456789012:role/TerraformExecutionRole
          role-external-id: ${{ secrets.EXTERNAL_ID }}
```

### Step 4: Set Up Terraform Provider

```hcl
provider "aws" {
  region = "us-west-2"
  
  # In CI/CD environment, explicit configuration isn't needed
  # as credentials are provided by the GitHub Actions AWS credentials action
  
  # For local development, you might use:
  # assume_role {
  #   role_arn     = "arn:aws:iam::123456789012:role/TerraformExecutionRole"
  #   session_name = "local-terraform-session"
  #   external_id  = "your-external-id"
  # }
}
```

This setup provides several security benefits:
- No long-lived credentials in your code
- Separation of duties through role assumption
- External ID as an additional security layer
- Limited permissions based on the role's policies

## Understanding Terraform AWS Authentication Flow

The following diagram illustrates how Terraform authenticates with AWS:

```mermaid
flowchart TB
    A[Terraform] -->|Uses credentials from| B{Credential Source}
    B -->|Option 1| C[Static Credentials]
    B -->|Option 2| D[Environment Variables]
    B -->|Option 3| E[Shared Credentials File]
    B -->|Option 4| F[EC2 Instance Role]
    B -->|Option 5| G[AssumeRole]
    B -->|Option 6| H[AWS SSO]
    
    C & D & E & F & G & H -->|Authenticated as| I[AWS Identity]
    I -->|Has permissions via| J[IAM Policies]
    I -->|Makes requests to| K[AWS API]
    
    K -->|Creates/Updates/Deletes| L[AWS Resources]
```

## Best Practices for AWS Authentication in Terraform

Follow these best practices to maintain security when authenticating Terraform with AWS:

1. **Never commit credentials** to version control systems
2. **Use temporary credentials** via IAM roles instead of long-lived access keys
3. **Implement least privilege** by restricting permissions to only what's necessary
4. **Rotate access keys** regularly if using IAM users
5. **Use external IDs** when assuming roles across accounts
6. **Enable MFA** for sensitive operations
7. **Use different roles** for different environments (dev, staging, production)
8. **Audit authentication events** regularly through CloudTrail
9. **Store sensitive values** in secure systems like AWS Secrets Manager or HashiCorp Vault
10. **Use named profiles** to avoid confusion between accounts

## Troubleshooting Authentication Issues

Common authentication issues and their solutions:

| Issue | Possible Solution |
|-------|-------------------|
| `Error: No valid credential sources found` | Check credential configuration and verify AWS CLI works |
| `Error: AccessDenied when calling the AssumeRole operation` | Verify the trust relationship and permissions on the role |
| `Error: ExpiredToken` | Refresh your temporary credentials or re-authenticate with SSO |
| `Error: InvalidClientTokenId` | Verify your access key is valid and enabled |
| `Error: UnauthorizedOperation` | The authenticated identity lacks required permissions |

## Exercise: Setting Up Secure Authentication

Try this exercise to practice secure AWS authentication with Terraform:

1. Create an IAM user with programmatic access and minimal permissions
2. Set up a named profile in your AWS credentials file
3. Create a simple Terraform configuration to list S3 buckets
4. Use environment variables for authentication
5. Then modify your configuration to use AssumeRole
6. Compare the approaches and identify which is most suitable for your use case

## Summary

Secure authentication is the foundation of safely using Terraform with AWS. This guide covered multiple authentication methods, from basic static credentials to more advanced techniques like role assumption and AWS SSO integration.

Key takeaways:
- Choose the authentication method that balances security and convenience for your specific use case
- Follow the principle of least privilege when assigning permissions
- Never hardcode credentials in your Terraform configurations
- Understand the credential lookup order to avoid unexpected authentication behaviors
- Use temporary credentials whenever possible

By implementing these practices, you'll establish a secure foundation for your infrastructure as code journey with Terraform and AWS.

## Additional Resources

- [AWS Provider Documentation](https://registry.terraform.io/providers/hashicorp/aws/latest/docs#authentication)
- [AWS IAM Best Practices](https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html)
- [Terraform Security Best Practices](https://www.terraform.io/docs/cloud/guides/recommended-practices/part3.1.html)
- [AWS Shared Responsibility Model](https://aws.amazon.com/compliance/shared-responsibility-model/)